# 什么是vim
 - vim是一个广泛用于Linux，WSL等操作系统的文本编辑器（×）
 - vim是一个因为对新手极度不友好而臭名昭著的文本编辑器（⚪）

vim难上手到什么地步呢？如果你需要生成一串随机字符串，你可以用vim打开一个文件，然后让一个不会用vim的人试图关闭它，你就得到了一串随机字符串。（just kidding！）
那么，我们该如何上手vim呢？

# 如何上手vim
## vimtutor，新手教程的不二之选
vimtutor是由UCL开发的一款vim入门教程。通常，安装了vim的系统都已经同时安装了vimtutor。直接在命令行中输入
```
$ vimtutor
```
就可以进入vimtutor的界面。vimtutor会通过文本解释与实际操作相结合的方式，介绍vim的基本功能该如何使用。

## 根据意义来记忆操作符
对于一个刚刚接触vim的人而言，顺着vimtutor从头到尾操作一两次，就可以对vim中的基本操作有一定的认知与记忆了。但与此同时，我们也可以发现，vim中的许多符号是有其意义，而不只是“一堆乱码”或者说“一串随机字符串”的。这里整理了一些vim中最常用的符号，与它们对应的意义。

### vim中的文本操作符（以下简称操作符）
| 操作符 | 直接意义 | 实际作用 |
|----------|-----------|-----------|
| i | insert | 开始插入文本 | 
| x | cut | 剪切文本（默认为剪切单个字符） |
| r | replace |替换单个字符 |
| R | replace | 开始替换文本 |
| o | open a new line | 新增一行并开始插入文本|
| c | change | 修改选中的文本（删除选中的文本并开始插入文本） |
| d | delete | 删除选中的文本 |
| dd | delete | 删除一行 |
| y | yank | 复制选中的文本 |
| p | paste | 粘贴被复制的文本 |

### vim中的文本定位符（以下简称定位符）
| 定位符 | 直接意义 | 实际作用 |
|--------|-----------------|--------------|
| w | word | 将光标移动到下一个词开头 |
| e | end | 将光标移动到这一个词末尾 | 
| b | beginning | 将光标移动到这一个词开头 |
| 0 | zero | 将光标移动到本行开头（与home键功能相同） |
| ^ | | 将光标移动到本行首个非空字符 |
| $ | | 将光标移动到本行末尾 |
| g | goto | |
| gg | goto | 将光标移动到第一行 |
| G | goto | 将光标移动到最后一行 |

### vim中的文件操作
vim中的文件操作通过前缀`:`来实现，每个操作符与其意义之间同样有对应关系。以下列举了几个常见的文件操作：
| 操作 | 意义 | 实际作用 |
|----------|----------|----------|
| `:w`  | working | 保存当前文件 | 
| `！` | override | 不保存当前文件 | 
| `:q` | quit | 退出当前文件 |
| `:a` | all | （对）所有文件（执行操作） |

这些操作符之间可以相互组合，例如
| 操作 | 实际作用 | 
|------|-------|
| `:wq` | 保存并退出当前文件 | 
| `:q!` | 忽略所有改动并退出当前文件 |
| `:wqa` | 保存并退出所有文件 、
| `:qa!` | 忽略改动并退出所有文件 | 

## vim黑魔法之符号组合
单纯使用操作符与定位符，能够进行的操作毕竟有限。好在就像前面看到的文件操作符之间的组合一样，vim可以通过符号间的组合实现强大的功能。

### 数字+定位符
数字符除了可以和方向符联合使用表示向该方向移动多少格之外，也可以和定位符联合使用。举几个例子：
| 符号组合 | 作用 |
|--------|-----------------|--------------|
| 2w | 将光标移动到往后第2个词开头 |
| 3e | end | 将光标移动到往后第3个词末尾 | 
| 4b | beginning | 将光标移动到往前第4个个词开头 |
| 5$ | | 将光标移动到包括本行在内第5行末尾 |
| 67gg | goto | 将光标移动到第67行 |

### 操作符+定位符
操作符和定位符也是可以联合使用的。举几个例子：
| 符号组合| 意义 | 实际作用 |
|--------|----------|---------|
| ce | change til end | 修改从光标到单词末尾的部分 | 
| dG | delete to last line | 删除从光标到文件末尾的部分 | 
| y$ | yank to end of line | 复制从光标到行末的部分 |

### 符号大乱炖
除此之外，操作符+数字符+定位符的组合也是可以的：

| 符号组合 | 作用 |
|--------|-----------------|--------------|
| y2w | 复制到接下来第2个词开头的部分 |
| 3dd/d3d | 删除包括本行在内接下来的3行 | 
| c4b | 修改从当前光标到往前第4个个词开头的部分 |
| d5$ | 删除包括本行在内的接下来5行 |

## vim文本编辑101
进入vim后，默认状态下是无法直接敲字母键盘来进行文本编辑的，如果你胡乱按的话，很大可能只会触发定位符键来移动光标。vim的文本编辑只能由前述的`i`键和`R`键进入输入（insert）模式或替换（replace）模式之后再进行。在这两种模式下，vim编辑器的左下角会以`--INSERT--`或者`--REPLACE--`显示当前的模式为输入模式或是替换模式。
除了使用`i`或者`R`分别进入输入模式或者替换模式之外，使用键盘上的insert键可以用来在这两种模式之间切换。在非编辑状态下，按`insert`键也可以直接进入输入模式。在这两种模式之下，按`Esc`键都可以退出编辑状态。
与此同时，vim下的剪切、复制、粘贴功能却是只有在非编辑模式下才能实现的，在编辑状态下按下`c`、`d`、`y`、`p`等操作符只会让你的文档中多出一堆乱码。如果你使用的是WSL等虚拟机，在外界环境下使用鼠标光标选中，再右键或者快捷键复制，纵然可以在其它的文本框中粘贴，却不能在vim中粘贴，只能老老实实在vim中选中再剪切、复制或者粘贴。
	
在只能使用之前提到的定位符时，选中文本再剪切、复制或者粘贴十分地不直观。好在vim有一个高亮并选中文本的“黑魔法”：

## vim黑魔法之visual mode
不同于windows系统中为了迁就键位而使用ctrl+v的组合实现粘贴功能，vim中的v字符是为了进入visual mode。这个模式类似于windows、mac中的鼠标选中功能，按下v之后再使用方向键或者定位符移动光标，就可以高亮并选中移动范围内所有字符了。选中之后可以使用`x, c, d, y`这些操作符来对被选中的文本进行剪切、删改、删除、复制这些操作。
除此之外，vim的ctrl+v可以进入visual block mode。不同于visual mode可以选中光标起始位置与当前位置之间的所有字符，visual block mode会以光标起始位置与当前位置为端点作出矩形，并选中矩形内的所有字符。对这些字符进行剪切或删除后的粘贴时，也是以矩形范围的形式。这个功能在批量增删tab时尤其有用。


# 如何（伪）玩转vim

仅仅只是有以上这些操作的话，vim似乎还是与windows记事本等“极简主义”编辑器差别不大。但是事实并非如此。以下将介绍一些vim中的进阶功能，有了这些功能，vim才真的拥有了和vscode等许多主流代码编辑器不相上下的功能。

## 从vim中进入命令行
想要从vim中执行命令行指令有两种方式。一种是直接在vim中操作：在非编辑模式下输入`:!`作为前缀，再输入命令行指令。例如，`:!pwd`，`:!ls`等。在命令行指令输出结果之后，再按提示按`Enter`键返回vim即可。
另一种方式是直接回归到命令行：在非编辑模式下按`Ctrl+Z`，vim就会暂停，同时回到命令行界面。之后在命令行中输入
```
$ fg
```
就可以返回正在运行中的vim。例如，当代码中有多条报错信息的时候，就可以用这种方式反复返回命令行查看报错信息指示的位置（文件行数），再利用`#gg`指令去到对应的位置，非常方便。

## vim中的窗口与窗格
像vscode等编辑器一样，vim可以同时打开多个标签页进行编辑。在已经打开了一个（或多个）文件的vim中，非编辑模式下，键入`:tabnew foo.txt`，就可以在新标签页中打开`foo.txt`并进行编辑。另外，此处键入文件名时，也可以像在命令行中一样按`Tab`键自动补全。
如果你不想新开标签页，但是想编辑另一个文件，也无需退出vim再重开，直接键入`:e foo.txt`（e for edit）就可以编辑。这种方式会退出目前正在编辑的文件，因此如果正在编辑的文件有没有保存的更改的话会报错。
除此之外，vim还可以在同一个标签页内打开多个窗格，同时阅读多个文件或者单个文件的不同部分。例如，你可以在写.cpp文件的同时打开.h文件，无需在文件之间来回切换，又或者可以同时打开某个很长文件的两个不同部分，无需在文件中滚来滚去。键入`:split`或者`vsplit`（v for vertical），即可纵向或者横向将标签页或者目前窗格划分为两个窗格。窗格操作的快捷方式是`Ctrl+W`（w for window），例如`Ctrl+W q`是退出当前窗格，`Ctrl+W ↑↓←→`是在窗格之间上下左右移动光标，等等，在此不赘述。

## vim中的查找替换
要说vscode之类的编辑器中的功能，查找替换一定是绕不过的。使用`Ctrl+F`，`Ctrl+H`这两个快捷键，就可以在全文档乃至全文件夹内查找和替换文本。

### vim中的查找
在vim中当然也是有类似的功能的：在非编辑模式下，使用`/word_pattern`，就可以在打开的文档内查找`word_pattern`；使用`n`到达下一处`word_pattern`，使用`N`到达上一处。另外，可以使用`:set hlsearch`打开查找时的高亮，使用`:nohlsearch`关闭高亮，使用`:hi Search ctermfg/ctermbg=Color`来设定查找高亮部分文字的颜色。
另外，如果想要在整个文件夹内查找，而不只是在打开的文件中查找的话，就需要使用另一个指令：`grep`。使用`Ctrl+Z`暂时退出vim，在命令行中输入
```
$ grep -r "word_pattern" *
```
就可以在整个文件夹，包括下属文件夹中的文件里查找`word_pattern`。其中`-r`代表recursively，指在本文件夹和下属文件夹中；`*`代表在所有文件中搜索，也可以换成`*.cpp`等。

### vim中的替换
vim中的替换也是一行指令的事：`:%s/pattern_a/pattern_b/gc`，就能全局替换`pattern_a`变成`pattern_b`。其中`s`代表substitute，即替换；最后一项`gc`为替换时的选项，`g`代表global即全局替换，去掉`g`即只在本行内替换；`c`代表在每次查找到`pattern_a`时手动指定是否替换，去掉`c`则直接全局替换。


## 使用vimrc

上面的所有以`:`开头的指令都可以放到`~/.vimrc`（即`home`文件夹下）中。类似`~/.bashrc`，`~/.vimrc`会在每次vim启动时访问并执行指令。[这里给出了一份供参考的`~/.vimrc`文件。](https://vim.fandom.com/wiki/Example_vimrc)

# 总结
看完上面的讲解，再辅以`$vimtutor`，相信大家对如何使用vim都已经有一些基本概念，可以上手使用了。新手使用vim的话，可以随时开着[vim cheatsheet](https://vim.rtorr.com/)，来查找不熟悉的指令；在不确定该如何使用高级指令的时候，可以询问Google或者百度，知乎、CSDN甚至stack overflow上也有许多关于vim的答